<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="fb:app_id" content="293758374637458" />
  <meta property="og:url" id="ogUrl" content="https://exff.ml/" />
  <meta property="og:type" content="website" />
  <meta property="og:title" id="ogTitle" content="Đồ dùng cần trao đổi" />
  <meta property="og:description" id="ogDescription" content="Trao đổi đồ dùng giữa người thân và bạn bè tại Exff" />
  <meta property="og:image" id="ogImgae" content="" />
  <title>Exff | Item</title>

  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <!-- Place favicon.ico in the root directory -->

  <!-- build:css styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="/bower_components/datetimepicker/jquery.datetimepicker.css" />
  <!-- endbower -->
  <!-- endbuild -->

  <!-- build:css styles/main.css -->
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild -->
  <!-- build:css vendor/font-awesome/css/font-awesome.min.css -->
  <link rel="stylesheet" href="/bower_components/Font-Awesome/css/all.min.css">
  <!-- endbuild -->

  <!-- build:js scripts/vendor/modernizr.js -->
  <script src="/bower_components/modernizr/modernizr.js"></script>
  <!-- endbuild -->
  <!-- build:js scripts/vendor/moment.js -->
  <script src="/bower_components/moment/min/moment.min.js"></script>
  <!-- endbuild -->
</head>

<body>
  <!--[if lt IE 10]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
  <div id="fb-root"></div>
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        appId: '293758374637458',
        xfbml: true,
        version: 'v3.2'
      });
      FB.AppEvents.logPageView();
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) { return; }
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>

  <div class="menu_bar__container">
    <div class="menu_bar">
      <div class="icon">
        <a class="reset" href="/">
          <img class="icon" src="./images/Logo-64px.png" alt="">
        </a>
      </div>
      <div class="logo">
        <a class="reset" href="/">
          <span>Exff</span>
        </a>
      </div>
      <div class="search_bar">
        <form action="#" id="searchForm">
          <input type="text" name="searchItem" id="inputSearch" placeholder="Search..." />
          <button id="btnSearch" class="primary"><i class="fas fa-search"></i></button>
        </form>
      </div>
      <div class="menu_bar__icon" id="btnBell">
        <i class="fas fa-bell"></i>
      </div>
      <div class="menu_bar__icon">
        <i class="fas fa-user-plus"></i>
      </div>

      <div class="user_icon" id="userInfoIcon">
        <a class="reset" href="./login.html">
          <i class="fas fa-user-circle"></i>
        </a>
      </div>
    </div>
  </div>
  <br>
  <br>

  <div class="item__container div--center flex flex_justify__center">
    <div class="item__image" id="imageContainer">
    </div>
    <div class="item__info position--relative">
      <div class="clearfix">
        <button onclick="share()" class="primary size--mini float-right">
          <i class="fab fa-facebook"></i> Chia sẻ
        </button>
        <p class="item__category">
          <b>Loại đồ dùng: </b>
          <span id="itemCategory"></span>
        </p>
        <div class="item__name">
          <p id="itemName"></p>
        </div>
      </div>

      <div class="clearfix">
        <a class="reset" id="tradeOfferLink" style="display: none;">
          <button class="primary float-right">Yêu cầu trao đổi</button>
        </a>
        <p>
          <b>Ngày đăng: </b>
          <span id="date"></span>
        </p>
        <p>
          <b>Địa chỉ: </b>
          <span id="itemAddress"></span>
        </p>
        <p><b>Thông tin:</b></p>
        <p id="itemDescription"></p>

      </div>
      <div>
        <p><b>Liên hệ:</b></p>
        <div class="item__user__info flex" id="userInfo">
          <div class="item__user__avatar position--relative">
            <div id="avatar" class="background" style="background-image: url('./images/no-image-icon-13.png')"></div>
          </div>
          <div class="flex flex_justify__center flex_vertical">
            <a id="userLink" class="primary">
              <p id="user"></p>
            </a>
            <p id="phoneNumber"></p>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- build:js scripts/vendor/jquery.js -->
  <!-- bower:js -->
  <script src="/bower_components/jquery/dist/jquery.js"></script>
  <script src="/bower_components/datetimepicker/build/jquery.datetimepicker.full.min.js"></script>
  <!-- endbower -->
  <!-- endbuild -->

  <!-- build:js scripts/main.js -->
  <script src="scripts/main.js"></script>
  <script src="scripts/menubar.js"></script>
  <script src="scripts/relationship.js"></script>
  <script src="scripts/validation.js"></script>
  <script src="scripts/item.js"></script>
  <script src="scripts/login.js"></script>
  <script src="scripts/register.js"></script>
  <script src="scripts/image.js"></script>
  <!-- endbuild -->
  <script>
    let overrideLink;
    let overrideTitle;
    let overrideDescription;
    let overrideImage;
    function share() {
      shareOverrideOGMeta(
        overrideLink,
        overrideTitle,
        overrideDescription,
        overrideImage);
    }
    function shareOverrideOGMeta(
      overrideLink = 'https://exff.ml/',
      overrideTitle = 'Đồ dùng cần trao đổi',
      overrideDescription = 'Trao đổi đồ dùng giữa người thân và bạn bè tại Exff',
      overrideImage = ''
    ) {
      FB.ui({
        method: 'share_open_graph',
        action_type: 'og.likes',
        action_properties: JSON.stringify({
          object: {
            'og:url': overrideLink,
            'og:title': overrideTitle,
            'og:description': overrideDescription,
            'og:image': overrideImage
          }
        })
      },
        function (response) {
        });
    }
  </script>
  <script>
    $(document).ready(() => {
      let urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has("id")) {
        let id = urlParams.get("id");
        getItem(
          id,
          getItemSuccess,
          getItemFalse
        );
      } else {
        window.location.replace("./error404.html");
      }
    });
    function initView(data) {

      const date = $("#date");
      const category = $("#itemCategory");
      const name = $("#itemName");
      const description = $("#itemDescription");
      const address = $("#itemAddress");

      const tradeOfferLink = $("#tradeOfferLink");
      let time = moment(data.createTime).format("DD/MM/YYYY");

      date.text(time);
      category.text(data.category.name);
      name.text(data.name);
      description.text(data.description);
      address.text(data.address);
      if (data.user.id != getUserId()) {
        tradeOfferLink.show();
        tradeOfferLink.attr("href", `./chat.html?userId=${data.user.id}&itemId=${data.id}`)
      }
      initUserInfo(data.user);
      initSlideShow(data.images);
    }

    function initUserInfo(data) {
      const user = $("#user");
      const phoneNumber = $("#phoneNumber");
      const avatar = $('#avatar');
      const link = $('#userLink');

      let image = data.avatar;

      user.text(data.fullName);
      phoneNumber.text(data.phoneNumber);
      link.attr('href', `./inventory.html?userId=${data.id}`);
      if (image !== undefined) {
        avatar.css('background-image', `url(${image})`);
      }
    }

    function initSlideShow(images) {
      const imageContainer = $("#imageContainer");
      imageContainer.append(renderSlideShow(images));
    }
    function initShareButton(data) {
      overrideLink = `https://exff.ml/item.html?id=${data.id}`;
      overrideTitle = data.name;
      overrideDescription = data.description;
      if (data.images != null && data.images.length > 0) {
        overrideImage = data.images[0].url;
      }
      $('#ogUrl').attr('content', `https://exff.ml/item.html?id=${data.id}`);
      $('#ogTitle').attr('content', data.name);
      $('#ogDescription').attr('content', data.description);
      $('#shareUrl').attr('data-href', `https://exff.ml/item.html?id=${data.id}`);
      if (data.images != null && data.images.length > 0) {
        $('#ogImgae').attr('content', data.images[0].url);
      }

    }
    function getItemSuccess(data) {
      initShareButton(data);
      initView(data);
    };
    function getItemFalse(err) {
      // console.log(err);
      // window.location.href = ("./error404.html");
    };
  </script>
</body>

</html>